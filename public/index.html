
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pokédex Viewer</title>
  <style>
    body {
      background-color: #1e1f26;
      font-family: 'Segoe UI', sans-serif;
      color: white;
      padding: 2rem;
      margin: 0;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
      font-size: 2.5rem;
    }
    #gen-tabs {
      text-align: center;
      margin-bottom: 2rem;
    }
    .gen-btn {
      padding: 0.5rem 1rem;
      margin: 0.25rem;
      background-color: #333;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .gen-btn.active {
      background-color: gold;
      color: black;
    }
    #search {
      display: block;
      margin: 0 auto 2rem auto;
      padding: 0.5rem;
      font-size: 1rem;
      width: 300px;
      border-radius: 8px;
      border: none;
      text-align: center;
    }
    #pokemon-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }
    .card {
      background-color: #2a2b38;
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      transition: transform 0.2s ease;
    }
    .card:hover {
      transform: scale(1.05);
    }
    .card img {
      width: 90px;
      height: 90px;
      object-fit: contain;
      margin-bottom: 0.5rem;
    }
    .dex-num {
      color: #ccc;
      font-size: 0.85rem;
    }
    #error-message {
      text-align: center;
      color: red;
      display: none;
    }
  </style>
</head>
<body>

<h1>Pokédex Viewer</h1>
<div id="gen-tabs"></div>
<input type="text" id="search" placeholder="Search Pokémon...">
<div id="pokemon-grid"></div>
<p id="error-message">⚠️ No matching Pokémon found.</p>

<script>
  const API_BASE = "https://tdxlxhwpj9.execute-api.us-east-2.amazonaws.com/prod/summary";
  const allData = {};
  let currentGen = 1;

  function renderGenTabs() {
    const tabContainer = document.getElementById("gen-tabs");
    tabContainer.innerHTML = "";
    for (let i = 1; i <= 9; i++) {
      const btn = document.createElement("button");
      btn.textContent = "Gen " + i;
      btn.className = "gen-btn";
      btn.dataset.gen = i;
      btn.addEventListener("click", () => loadAndSwitchGen(i));
      tabContainer.appendChild(btn);
    }
  }

  async function loadAndSwitchGen(gen) {
    currentGen = gen;
    document.querySelectorAll(".gen-btn").forEach(btn =>
      btn.classList.toggle("active", parseInt(btn.dataset.gen) === gen)
    );
    if (!allData[gen]) {
      const res = await fetch(API_BASE + "?generation=" + gen);
      const raw = await res.json();
      const data = JSON.parse(raw.body);
      allData[gen] = data;
    }
    renderGrid(allData[gen]);
  }

  function renderGrid(pokemonList) {
    const grid = document.getElementById("pokemon-grid");
    const search = document.getElementById("search").value.toLowerCase();
    grid.innerHTML = "";

    const filtered = pokemonList.filter(p =>
      p.pokemon && p.pokemon.toLowerCase().includes(search)
    );

    document.getElementById("error-message").style.display = filtered.length ? "none" : "block";

    filtered.forEach(p => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img src="${p.pokemon_image}" alt="${p.pokemon}" />
        <h3>${p.pokemon}</h3>
        <p class="dex-num">#${p.dex_number?.toString().padStart(3, '0') || ""}</p>
      `;
      grid.appendChild(card);
    });
  }

  async function searchAllGenerations(term) {
    const name = term.toLowerCase();
    for (let gen = 1; gen <= 9; gen++) {
      if (!allData[gen]) {
        const res = await fetch(API_BASE + "?generation=" + gen);
        const raw = await res.json();
        allData[gen] = JSON.parse(raw.body);
      }
      const match = allData[gen].find(p => p.pokemon.toLowerCase() === name);
      if (match) {
        currentGen = gen;
        renderGenTabs();
        switchToGen(gen);
        document.getElementById("search").value = match.pokemon;
        return;
      }
    }
    document.getElementById("error-message").style.display = "block";
  }

  function switchToGen(gen) {
    document.querySelectorAll(".gen-btn").forEach(btn =>
      btn.classList.toggle("active", parseInt(btn.dataset.gen) === gen)
    );
    renderGrid(allData[gen] || []);
  }

  document.getElementById("search").addEventListener("input", async (e) => {
    const val = e.target.value.trim();
    if (val.length >= 2) {
      await searchAllGenerations(val);
    } else {
      renderGrid(allData[currentGen] || []);
    }
  });

  async function init() {
    renderGenTabs();
    await loadAndSwitchGen(1);
  }

  init();
</script>

</body>
</html>
